angular.module("angular-toolbar",["angular-toolbar-directives"]),angular.module("angular-toolbar-directives",[]).provider("toolbarConfig",[function(){this.config=function(config){this.config=config},this.$get=function(){return this}}]).directive("toolbtn",["$rootScope","$compile","$document","$timeout","$templateCache","$interpolate",function($rootScope,$compile,$document,$timeout,$templateCache,$interpolate){return{replace:!0,controllerAs:"ctrl",bindToController:{bstyle:"@",event:"@",size:"@",icon:"@",model:"=ngModel"},restrict:"AE",scope:{},template:'<div class=test><div id={{ctrl.bid}} class="btn {{ctrl.bstyle}} {{ctrl.size}}"><i class={{ctrl.icon}}></i></div></div>',controller:function($scope,$element,$rootScope){var ctrl=this;if(ctrl.bid=ctrl.bid||ctrl.model.bid,ctrl.bstyle=ctrl.bstyle||ctrl.model.bstyle||"btn-success",ctrl.event=ctrl.event||ctrl.model.event||"click",ctrl.size=ctrl.size||ctrl.model.size||"",ctrl.icon=ctrl.icon||ctrl.model.icon||"fa fa-question",ctrl.model.toolbar){ctrl.toolbar=ctrl.model.toolbar;var body=angular.element(document).find("body").eq(0),toolbar='<toolbar ng-model="ctrl.toolbar"></toolbar>';body.append($compile(toolbar)($scope))}var is_clicked=!1;ctrl.handle_event=function(){"mouseover"===ctrl.event?($element.bind("mouseover",function(event){console.log("mouseover toolbtn"),$rootScope.$broadcast("showToolbar",[ctrl.id])}),$element.bind("mouseleave",function(event){console.log("mouseleave toolbtn"),$rootScope.$broadcast("perhapsHideToolbar",[ctrl.id])})):$element.bind("click",function(){is_clicked===!1?($rootScope.$broadcast("showToolbar",[ctrl.id]),is_clicked=!0):($rootScope.$broadcast("hideToolbar",[ctrl.id]),is_clicked=!1)})},ctrl.handle_event(),$scope.$watch("ctrl.model.event",function(new_event){"click"===ctrl.event&&$element.unbind("click"),"mouseover"===ctrl.event&&($element.unbind("mouseover"),$element.unbind("mouseleave")),ctrl.event=ctrl.model.event||"click",ctrl.handle_event()}),$scope.$watch("ctrl.model.bstyle",function(new_style){ctrl.bstyle=ctrl.model.bstyle||"btn-success"}),$scope.$watch("ctrl.model.icon",function(new_icon){ctrl.icon=ctrl.model.icon||"fa fa-question"}),$scope.$watch("ctrl.model.size",function(new_size){ctrl.size=ctrl.model.size||""})}}}]).directive("toolbarbtn",["$compile","$document","$timeout","$templateCache","$interpolate",function($compile,$document,$timeout,$templateCache,$interpolate){return{replace:!0,require:"^toolbar",controllerAs:"ctrl",bindToController:{bstyle:"@",click:"@",size:"@",icon:"@",model:"=ngModel"},restrict:"AE",scope:{},template:'<button type=button href=# class="btn {{ctrl.size}} {{ctrl.bstyle}}" ng-click=ctrl.myclick(ctrl.click)><i class={{ctrl.icon}}></i></button>',controller:function($scope,$element,$rootScope){var ctrl=this;ctrl.bstyle=ctrl.bstyle||ctrl.model.bstyle||"btn-success",ctrl.click=ctrl.click||ctrl.model.click||"donothing",ctrl.size=$scope.$parent.$parent.ctrl.size||$scope.$parent.ctrl.size||"",ctrl.icon=ctrl.icon||ctrl.model.icon||"fa fa-question",ctrl.myclick=function(){$timeout(function(){$rootScope.$eval(ctrl.click)},0,!1)},$scope.$watch("$parent.ctrl.size",function(new_style){ctrl.size=$scope.$parent.ctrl.size||""})}}}]).directive("toolbar",["$rootScope","$compile","$document","$timeout","$templateCache","$interpolate","$interval",function($rootScope,$compile,$document,$timeout,$templateCache,$interpolate,$interval){return{replace:!0,transclude:!0,controllerAs:"ctrl",bindToController:{bid:"@",position:"@",tools:"@",alignment:"@",size:"@",model:"=ngModel"},restrict:"AE",scope:{},template:'<div id=toolbar-{{ctrl.bid}} class="tool-container tool-{{ctrl.position}} toolbar-info-o" style=position:absolute;width:auto;right:auto;opacity:0;><div class={{ctrl.btn_group}}><toolbarbtn ng-repeat="(key, tool) in ctrl.tools track by $index" ng-model=tool></toolbarbtn><span ng-transclude-replace></span></div><div class=arrow ng-class={{ctrl.arrow_top}}></div></div>',controller:function($scope,$element,$rootScope){var ctrl=this;ctrl.bid=ctrl.bid||ctrl.model.bid,ctrl.position=ctrl.position||ctrl.model.position||"top",ctrl.tools=ctrl.tools||ctrl.model.tools||{},ctrl.animation=ctrl.animation||ctrl.model.animation||"animate-standard",ctrl.alignment=ctrl.alignment||ctrl.model.alignment||"normal",ctrl.size=ctrl.size||ctrl.model.size||"",ctrl.adjustment=10,ctrl.btn_group=ctrl.btn_group||ctrl.model.btn_group||"btn-group",ctrl.arrow_top=ctrl.arrow_top||ctrl.model.arrow_top||!1;var isMouseOver=!1;$rootScope.$on("showToolbar",function(event,data){console.log("on showToolbar",data),ctrl.showToolbar(),$element.bind("mouseover",function(event){isMouseOver=!0}),$element.bind("mouseleave",function(event){isMouseOver=!1,$timeout(function(){isMouseOver||ctrl.hideToolbar()},500)}),$element.bind("mouseenter",function(event){isMouseOver=!0})}),$rootScope.$on("hideToolbar",function(event,data){console.log("on hideToolbar",data),isMouseOver||ctrl.hideToolbar()}),$rootScope.$on("perhapsHideToolbar",function(event,data){console.log("on perhapsHideToolbar",isMouseOver),$timeout(function(){console.log("on perhapsHideToolbar 2",isMouseOver),isMouseOver||ctrl.hideToolbar()},500)});var body=angular.element(document).find("body").eq(0);body.append($element),ctrl.showToolbar=function(){ctrl.positionToolbar(),$element.addClass(ctrl.animation),$element.css("opacity",1)},ctrl.hideToolbar=function(){$element.removeClass(ctrl.animation),$element.css("opacity",0)},ctrl.positionToolbar=function(){var my_elm=angular.element(document.getElementById("toolbar-"+ctrl.bid)),coord=ctrl.getCoordinates(my_elm);$element.css("left",coord.left),$element.css("top",coord.top)},ctrl.getCoordinates=function(toolbox){var toolbtn=angular.element(document.getElementById(ctrl.bid)),toolbtn_width="undefined"!=typeof toolbtn[0]?toolbtn[0].offsetWidth:0,toolbtn_height="undefined"!=typeof toolbtn[0]?toolbtn[0].offsetHeight:0,coordinates=ctrl.getElementOffset(toolbtn),toolbar_outer_width="undefined"!=typeof toolbox[0]?toolbox[0].clientWidth:0,toolbar_outer_height="undefined"!=typeof toolbox[0]?toolbox[0].clientHeight:0;switch(ctrl.position){case"top":return{left:coordinates.left+toolbtn_width/2-toolbar_outer_width/2+"px",top:coordinates.top-toolbar_outer_height-ctrl.adjustment+"px"};case"left":return{left:coordinates.left-toolbar_outer_width-ctrl.adjustment+"px",top:coordinates.top+toolbtn_height/2-toolbar_outer_height/2+"px"};case"right":return{left:coordinates.left+toolbtn_width+ctrl.adjustment+"px",top:coordinates.top+toolbtn_height/2-toolbar_outer_height/2+"px"};case"bottom":return{left:coordinates.left+toolbtn_width/2-toolbar_outer_width/2+"px",top:coordinates.top+toolbtn_height+ctrl.adjustment+"px"}}},ctrl.getElementOffset=function(toolbox){if("undefined"!=typeof toolbox[0]){var de=document.documentElement,box=toolbox[0].getBoundingClientRect(),top=box.top+window.pageYOffset-de.clientTop,left=box.left+window.pageXOffset-de.clientLeft;return{top:top,left:left}}return{top:0,left:0}},ctrl.get_toolbar_btn_group=function(){"normal"===ctrl.alignment&&("top"===ctrl.position||"bottom"===ctrl.position?(ctrl.arrow_top=!0,ctrl.btn_group="btn-group"):(ctrl.arrow_top=!1,ctrl.btn_group="btn-group-vertical")),"angle"===ctrl.alignment&&("top"===ctrl.position||"bottom"===ctrl.position?(ctrl.arrow_top=!0,ctrl.btn_group="btn-group-vertical"):(ctrl.arrow_top=!1,ctrl.btn_group="btn-group"))},ctrl.get_toolbar_btn_group(),$scope.$watch("ctrl.model.animation",function(new_style){ctrl.animation=ctrl.model.animation||"animate-standard"}),$scope.$watch("ctrl.model.position",function(new_style){ctrl.position=ctrl.model.position||"top"}),$scope.$watch("ctrl.model.size",function(new_style){ctrl.size=ctrl.model.size||""}),$scope.$watch("ctrl.model.alignment",function(new_style){ctrl.alignment=ctrl.model.alignment||"normal",ctrl.get_toolbar_btn_group()})}}}]).directive("ngTranscludeReplace",["$log",function($log){return{terminal:!0,restrict:"EA",link:function($scope,$element,$attr,ctrl,transclude){return transclude?void transclude(function(clone){clone.length?$element.replaceWith(clone):$element.remove()}):void $log.error("orphan","Illegal use of ngTranscludeReplace directive in the template! No parent directive that requires a transclusion found. ")}}}]);